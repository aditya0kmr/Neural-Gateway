<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus Gateway - Firebase Build</title>
    <style>
        :root {
            --glass-bg: rgba(20, 20, 30, 0.4);
            --glass-border: rgba(255, 255, 255, 0.1);
            --neon-blue: #00f3ff;
            --neon-purple: #bc13fe;
            --neon-red: #ff0055;
            --text-primary: #ffffff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Courier New', monospace;
        }

        body,
        html {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: #020205;
            color: var(--text-primary);
        }

        /* 3D Canvas */
        canvas {
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1;
            outline: none;
        }

        /* UI Overlay */
        #ui-layer {
            position: relative;
            z-index: 10;
            height: 100%;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background: radial-gradient(circle at center, transparent 0%, #000 120%);
        }

        /* Boot Screen */
        #boot-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 100;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            transition: opacity 1s ease;
        }

        .terminal-text {
            color: var(--neon-blue);
            font-size: 1.2rem;
            text-shadow: 0 0 10px var(--neon-blue);
        }

        /* Scanlines */
        .scanlines {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, rgba(255, 255, 255, 0), rgba(255, 255, 255, 0) 50%, rgba(0, 0, 0, 0.1) 50%, rgba(0, 0, 0, 0.1));
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 50;
            opacity: 0.3;
        }

        /* Login Box */
        .login-container {
            width: 420px;
            padding: 40px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-left: 2px solid var(--neon-blue);
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            opacity: 0;
            transform: scale(0.9);
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }

        .login-container.visible {
            opacity: 1;
            transform: scale(1);
        }

        .login-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--neon-blue), transparent);
            animation: scan 2s linear infinite;
        }

        @keyframes scan {
            0% {
                transform: translateX(-100%);
            }

            100% {
                transform: translateX(100%);
            }
        }

        h1 {
            font-size: 2rem;
            letter-spacing: 5px;
            text-transform: uppercase;
            margin-bottom: 30px;
            text-align: center;
            color: #fff;
            text-shadow: 0 0 20px var(--neon-blue);
        }

        .input-group {
            position: relative;
            margin-bottom: 25px;
        }

        input {
            width: 100%;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid #333;
            color: #fff;
            font-size: 1rem;
            transition: 0.3s;
        }

        input:focus {
            border-color: var(--neon-blue);
            box-shadow: 0 0 15px rgba(0, 243, 255, 0.2);
            outline: none;
        }

        input:focus+label,
        input:valid+label {
            top: -10px;
            left: 10px;
            font-size: 0.7rem;
            background: #000;
            padding: 0 5px;
            color: var(--neon-blue);
        }

        label {
            position: absolute;
            top: 15px;
            left: 15px;
            color: #888;
            pointer-events: none;
            transition: 0.3s;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        button {
            width: 100%;
            padding: 15px;
            margin-top: 10px;
            background: transparent;
            border: 1px solid var(--neon-blue);
            color: var(--neon-blue);
            font-size: 1rem;
            letter-spacing: 3px;
            cursor: pointer;
            transition: 0.3s;
            text-transform: uppercase;
        }

        button:hover {
            background: var(--neon-blue);
            color: #000;
            box-shadow: 0 0 20px var(--neon-blue);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            filter: grayscale(1);
        }

        .status-msg {
            margin-top: 15px;
            text-align: center;
            font-size: 0.8rem;
            letter-spacing: 1px;
            min-height: 1.2rem;
        }

        .success {
            color: #33ff33;
            text-shadow: 0 0 10px #33ff33;
        }

        .error {
            color: var(--neon-red);
            text-shadow: 0 0 10px var(--neon-red);
        }

        .hidden {
            display: none !important;
        }
    </style>

    <!-- LIBRARIES -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/mrdoob/three.js@r128/examples/js/controls/OrbitControls.js"></script>

    <!-- FIREBASE (Compat for file:// usage) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
</head>

<body>
    <div class="scanlines"></div>

    <!-- BOOT SCREEN -->
    <div id="boot-screen">
        <div class="terminal-text" id="boot-text">_</div>
    </div>

    <!-- MAIN UI -->
    <div id="ui-layer">
        <div class="login-container" id="login-panel">
            <h1>Nexus Gateway</h1>

            <form id="login-form" onsubmit="return false;">
                <div class="input-group">
                    <input type="text" id="username" required autocomplete="off">
                    <label>Identity</label>
                </div>

                <div class="input-group">
                    <input type="password" id="password">
                    <label>Passkey</label>
                </div>

                <button type="submit" id="btn-login">Connect</button>
                <div class="status-msg" id="status-msg"></div>
            </form>
        </div>
    </div>

    <script>
        // --- FIREBASE CONFIG ---
        const firebaseConfig = {
            apiKey: "AIzaSyCOI2izcckQumJ9JnhLG-3Xrd1uSqyRGTU",
            authDomain: "neural-gateway.firebaseapp.com",
            projectId: "neural-gateway",
            storageBucket: "neural-gateway.firebasestorage.app",
            messagingSenderId: "358711638377",
            appId: "1:358711638377:web:5d76e55275b21f7213e5f8"
        };

        // Init Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();


        // --- 1. CONFIG & STATE ---
        const COLORS = {
            cyan: new THREE.Color(0x00f3ff),
            magenta: new THREE.Color(0xbc13fe),
            red: new THREE.Color(0xff0055),
            idle: new THREE.Color(0x0044aa)
        };

        const state = {
            warp: false,
            intensity: 1.0,
            targetColor: COLORS.idle,
            currentColor: new THREE.Color(0x0044aa)
        };

        // --- 2. THREE.JS WORLD ---
        const scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(0x020205, 0.03);

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 8;

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        document.body.appendChild(renderer.domElement);

        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableZoom = false; controls.autoRotate = true; controls.autoRotateSpeed = 0.5;

        // Lights
        const ambient = new THREE.AmbientLight(0x404040, 2);
        scene.add(ambient);
        const pointLight = new THREE.PointLight(0x00f3ff, 2, 50);
        pointLight.position.set(5, 5, 5);
        scene.add(pointLight);

        // Core Objects
        const coreGroup = new THREE.Group();
        scene.add(coreGroup);

        const coreGeo = new THREE.IcosahedronGeometry(1.6, 1);
        const coreMat = new THREE.MeshStandardMaterial({
            color: 0x00ffff, emissive: 0x001133, emissiveIntensity: 1,
            wireframe: true, transparent: true, opacity: 0.9
        });
        const core = new THREE.Mesh(coreGeo, coreMat);
        coreGroup.add(core);

        // Rings
        const ringMat = new THREE.MeshBasicMaterial({ color: 0x444444, wireframe: true, transparent: true, opacity: 0.2 });
        const rings = [];
        for (let i = 1; i <= 3; i++) {
            const ring = new THREE.Mesh(new THREE.TorusGeometry(2 + i * 0.4, 0.02, 16, 100), ringMat);
            coreGroup.add(ring);
            rings.push(ring);
        }

        // Particles
        const packets = [];
        const packetMat = new THREE.MeshBasicMaterial({ color: 0xffffff });

        function spawnPacket(colorVal) {
            const mesh = new THREE.Mesh(new THREE.SphereGeometry(0.08, 8, 8), packetMat.clone());
            mesh.material.color.set(colorVal); // Match current core color

            mesh.position.set((Math.random() - 0.5) * 2, -4, 4);
            const packet = {
                mesh: mesh,
                velocity: new THREE.Vector3((Math.random() - 0.5) * 0.2, 0.15, -0.25)
            };
            scene.add(mesh);
            packets.push(packet);
        }

        // Stars
        const starGeo = new THREE.BufferGeometry();
        const starPos = [];
        for (let i = 0; i < 3000; i++) {
            starPos.push((Math.random() - 0.5) * 100, (Math.random() - 0.5) * 100, (Math.random() - 0.5) * 100);
        }
        starGeo.setAttribute('position', new THREE.Float32BufferAttribute(starPos, 3));
        const stars = new THREE.Points(starGeo, new THREE.PointsMaterial({ size: 0.1, color: 0xffffff }));
        scene.add(stars);


        // --- 3. ANIMATION LOOP ---
        const clock = new THREE.Clock();

        function animate() {
            requestAnimationFrame(animate);
            const time = clock.getElapsedTime();

            // Color Lerp
            state.currentColor.lerp(state.targetColor, 0.05);
            core.material.emissive.copy(state.currentColor);
            core.material.color.copy(state.currentColor);
            pointLight.color.copy(state.currentColor);

            // Intensity Decay
            if (state.intensity > 1) state.intensity -= 0.05;

            // Core Rotation
            const speed = 0.5 * state.intensity;
            core.rotation.x = time * 0.5 * speed;
            core.rotation.y = time * 0.2 * speed;
            const pulse = 1 + Math.sin(time * 3 * speed) * (0.05 * state.intensity);
            core.scale.set(pulse, pulse, pulse);

            rings.forEach((r, i) => {
                r.rotation.x = time * (0.2 + i * 0.1) * (i % 2 ? 1 : -1);
                r.rotation.y = time * 0.1;
                r.material.color.copy(state.currentColor).offsetHSL(0, 0, -0.4); // Darker version
            });

            // Particles
            for (let i = packets.length - 1; i >= 0; i--) {
                const p = packets[i];
                p.mesh.position.add(p.velocity);
                p.velocity.multiplyScalar(1.02); // Accel
                // Curve to center
                p.velocity.add(p.mesh.position.clone().multiplyScalar(-0.01));

                if (p.mesh.position.length() < 1) {
                    scene.remove(p.mesh);
                    packets.splice(i, 1);
                }
            }

            // Warp Checks
            controls.update();
            if (state.warp) {
                // Shake & Zoom
                camera.position.z = THREE.MathUtils.lerp(camera.position.z, 0, 0.03);
                camera.position.x += (Math.random() - 0.5) * 0.1;

                // Star Stretch
                const pos = stars.geometry.attributes.position.array;
                for (let i = 2; i < pos.length; i += 3) {
                    pos[i] += 2; // Move Z
                    if (pos[i] > 20) pos[i] = -50;
                }
                stars.geometry.attributes.position.needsUpdate = true;
            } else {
                stars.rotation.y = time * 0.05;
            }

            renderer.render(scene, camera);
        }
        animate();


        // --- 4. UI LOGIC & FIREBASE ---
        const ui = {
            user: document.getElementById('username'),
            pass: document.getElementById('password'),
            form: document.getElementById('login-form'),
            panel: document.getElementById('login-panel'),
            status: document.getElementById('status-msg'),
            boot: document.getElementById('boot-screen'),
            bootText: document.getElementById('boot-text'),
            btn: document.getElementById('btn-login')
        };

        // Boot Sequence
        const bootLines = ["Loading Core...", "Syncing Neural Net...", "Connecting to Firebase...", "Ready."];
        let lineIdx = 0;
        const typeInterval = setInterval(() => {
            ui.bootText.innerText = bootLines[lineIdx];
            lineIdx++;
            if (lineIdx >= bootLines.length) {
                clearInterval(typeInterval);
                setTimeout(() => {
                    ui.boot.style.opacity = '0';
                    setTimeout(() => ui.boot.style.display = 'none', 1000);
                    setTimeout(() => ui.panel.classList.add('visible'), 500);
                }, 500);
            }
        }, 600);


        // Interaction
        ui.user.addEventListener('focus', () => { state.targetColor = COLORS.cyan; controls.autoRotate = false; });
        ui.pass.addEventListener('focus', () => { state.targetColor = COLORS.magenta; controls.autoRotate = false; });
        ui.user.addEventListener('blur', () => { state.targetColor = COLORS.idle; controls.autoRotate = true; });
        ui.pass.addEventListener('blur', () => { state.targetColor = COLORS.idle; controls.autoRotate = true; });

        function typeEffect() { spawnPacket(state.currentColor); state.intensity = 4.0; }
        ui.user.addEventListener('input', typeEffect);
        ui.pass.addEventListener('input', typeEffect);

        // --- AUTHENTICATION HANDLER ---
        ui.form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const u = ui.user.value.trim().toLowerCase();
            const p = ui.pass.value;

            ui.status.innerText = "AUTHENTICATING...";
            ui.status.className = "status-msg";
            ui.btn.disabled = true;

            try {
                let userCredential;

                if (u === 'other') {
                    // Anonymous Auth
                    userCredential = await auth.signInAnonymously();
                } else if (u === 'aadi' || u === 'nanniii') {
                    // Email Auth via "nexus.bot" domain
                    const email = `${u}@nexus.bot`;
                    userCredential = await auth.signInWithEmailAndPassword(email, p);
                } else {
                    throw { code: "custom/invalid-user", message: "User identity unknown." };
                }

                // Success!
                handleSuccess(u);

            } catch (error) {
                let msg = error.message;
                if (error.code === 'auth/user-not-found') msg = "User not registered.";
                if (error.code === 'auth/wrong-password') msg = "Invalid Passkey.";
                handleError(msg);
            }
        });

        function handleSuccess(identity) {
            ui.status.innerText = "ACCESS GRANTED. JUMPING...";
            ui.status.className = "status-msg success";
            ui.panel.style.transform = "scale(1.1)";
            ui.panel.style.opacity = "0";
            state.warp = true;

            setTimeout(() => {
                document.body.innerHTML = `
                    <div style="height:100%;display:flex;justify-content:center;align-items:center;background:#fff;animation:flash 2s forwards;">
                        <h1 style="color:#000;font-family:sans-serif;font-weight:900;letter-spacing:10px;">WELCOME ${identity.toUpperCase()}</h1>
                    </div>
                    <style>@keyframes flash { 0%{background:#fff;} 100%{background:#eee;} }</style>
                `;
            }, 4000);
        }

        function handleError(msg) {
            ui.status.innerText = "ERROR: " + msg.toUpperCase(); // Basic error msg
            ui.status.className = "status-msg error";
            ui.btn.disabled = false;

            state.targetColor = COLORS.red;
            setTimeout(() => state.targetColor = COLORS.idle, 500);

            // Shake
            ui.panel.style.transform = "translateX(10px)";
            setTimeout(() => ui.panel.style.transform = "translateX(-10px)", 50);
            setTimeout(() => ui.panel.style.transform = "translateX(0)", 100);
        }

        window.onresize = () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        };
    </script>
</body>

</html>